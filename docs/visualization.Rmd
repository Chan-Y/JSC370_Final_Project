---
title: "Interactive Visualizations"
subtitle: "For Assignment 5"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

```{r setup, message=FALSE, echo=FALSE, include=FALSE, eval=TRUE, warning=FALSE}
library(data.table)
library(tidyverse)
library(dplyr)
library(plotly)
library(DT)
library(knitr)

# Initialize code chunk options
opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  eval=TRUE,
  echo = TRUE,
  cache = FALSE,
  fig.width = 7, 
  fig.align = 'center',
  fig.asp = 0.618,
  out.width = "700px",
  class.source = "code-r")
```

```{css, echo = FALSE}
.code-r { /* Code block */
  font-size: 15px;
}

.code-r-small { /* Code block */
  font-size: 10px;
}
```


```{r load-data, include=FALSE, eval=TRUE}
source("resources/data/process_data.R")
```
<br>

This is my JSC370 Final Project website. I will showcase a few interactive visuals here.

<br>

<br>

<br>

## Second step

Then I will add some code to create the **plotly** figures

Note: You need to name each code chunk, like this one: `plot1`

```{r plots, include=FALSE, eval=TRUE}
count_by_month_cat <- data %>% 
  group_by(year, month_num, crime_cat) %>% 
  summarise(
    count = length(unique(event_unique_id))
  )

plt1 <- count_by_month_cat %>% 
  mutate(
    month = ym(paste0(year, '-', month_num))
  ) %>% 
  group_by(month) %>% 
  summarise(
    count = sum(count)
  ) %>% 
  inner_join(merged_rate, by=c("month" = "month_date")) %>% 
  ggplot(aes(x = month, y = count)) +
  geom_bar(stat = "identity", fill = "lightblue")+
  theme_classic()+
  geom_line(aes(x = month, y = inflation * 100, group = 1, color = "Inflation")) +
  geom_point(aes(x = month, y = inflation * 100, color = "Inflation"), size = 2) +
  geom_line(aes(x = month, y = unemployment * 100, group = 1, color = "Unemployment")) +
  geom_point(aes(x = month, y = unemployment * 100, color = "Unemployment"), size = 2) +
  scale_color_manual(values = c("Inflation" = "blue", "Unemployment" = "red"), 
                     name = "Rates", labels = c("Inflation", "Unemployment")) +
  labs(
    title = "Number of Crime Occurrence over Time",
    x = "Year", y = "Number of Crimes"
  ) +
  scale_y_continuous(
    name = "Number of Crimes",
    sec.axis = sec_axis(~ . / 100, name = "Rates (%)" )
  )


# Top 10 for each crime category
plt2 <- data %>%
  group_by(neighbourhood, crime_cat) %>% 
  summarise(
    count = length(unique(event_unique_id))
  ) %>% 
  group_by(crime_cat) %>%
  slice_max(count, n = 5)  %>% 
  ggplot(aes(neighbourhood, y=count)) +
  geom_bar(stat="identity", fill = "lightblue") +
  facet_wrap(~crime_cat, scales = "free_y") +
  theme_minimal() +
  coord_flip() +
  labs(title = "Barplot of Crime Occurrence by Neighbourhood", 
       subtitle = "Focus on top 5 neighbours in each crime category",
       x  = "Neighbourhood", y = "Number of Crime Occurrence")
```

<br>

## Third step {.tabset}

Create tabs to display each figure

### Scatterplot: with DC

```{r plt1, echo=FALSE}
plt1
```

### Scatterplot: without DC

```{r plt2, echo=FALSE}
plt2
```

### W/O DC Log transformed
```{r}

```


<br>

Done!

<br>
<br>